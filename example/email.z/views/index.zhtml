<html>
  <head>
    <meta charset="utf-8">
    <title>Point Network Email Example App</title>
  </head>
  <body>
    {% set receipient = '0xf990AB98B33dd48dffaC735C572D6cd8f75E60d8' %}
    {% set receipient_public_key = identity_ikv_get(receipient, 'public_key') %}
    {% set emailContractAddress = identity_ikv_get('email', 'zweb/contracts/address/Email') %}
    {% set wallet = load_node_wallet() %}

    <div>
      <img alt="Point Network Email" src="images/email-logo.png" width="200" height="200"></img>
      <p><b>Point Network Email Example App</b>. Demos the powers of ZHTML + Solidity + DHT!!</p>
    </div>

    <p>You are authenticated using account FROM: <b>{{ wallet.address }}</b></p>
    <p>This demo will send a Point Network Email TO: <b>{{ receipient }}</b></p>

    {% block contents %}
      <form method="post" action="/_contract_send/Email.send(to,contents)" onSubmit="return encrypt();">
        <input type="hidden" name="to" value="{{ receipient }}" />
        <textarea id="body" rows="4" cols="50" name="storage[contents]"></textarea><br/><br/>
        <input type="submit" value="Encrypt & Send Email"/>
      </form>
    {% endblock contents %}

    {% block javascript %}

      <script language="JavaScript">
        // set local javascript variables from twig variables
        let to = "{{ receipient }}"
        let emailContractAddress = "{{ emailContractAddress }}"
      </script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.5/web3.min.js"></script>
      <script language="JavaScript" src="email.js"></script>

    {% endblock javascript %}

    <div style="border:blue; border-width:1px; border-style:solid; padding: 5px;">
      <i>Debug Console (ignore this unless you are a dev!)</i>
      <br/>
      <br/>
      <div id="div1">The text above has been created dynamically by the loaded email js file.</div>
      <div id="public_key">The public key of {{ receipient }} is {{ receipient_public_key }}</div>
    </div>
  </body>
</html>