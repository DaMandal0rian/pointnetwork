# point-e2e is used for starting the e2e environment (for development and testing usage only)
alias point-e2e="docker-compose --env-file .env.e2e -f docker-compose.e2e.yaml "

# point-browser-docker-N starts a point browser instance for one of the locally saved e2e environment profiles.
alias point-browser-docker-1="web-ext run --firefox-profile=storage_provider_docker --keep-profile-changes --source-dir dist/prod --url https://point/"
alias point-browser-docker-2="web-ext run --firefox-profile=website_owner_docker --keep-profile-changes --source-dir dist/prod --url https://point/"
alias point-browser-docker-3="web-ext run --firefox-profile=website_visitor_docker --keep-profile-changes --source-dir dist/prod --url https://point/"

build-e2e() {
    local image=$(git branch --show-current | sed 's/[^a-zA-Z0-9]/-/g');

    docker image inspect pointnetwork/pointnetwork_node:$image > /dev/null 2>&1;

    if [[ $? != 0 ]] || [ "$1" == "--force" ]; then
        echo "Building image: pointnetwork/pointnetwork_node:$image";
        docker build -t "pointnetwork/pointnetwork_node:$image" .;
        perl -i -pe"s/POINT_NODE_VERSION=.*/POINT_NODE_VERSION=$image/" .env.e2e;
    else
        echo "Docker Image for current branch exists. To rebuild the image run 'build-e2e --force'";
    fi;
}

# point-browser opens a point browser instance using the pointnetwork profile that should be pointing to the default live network of pointnetwork (currently YNet but eventually this would be mainnet)
alias point-browser="web-ext run --firefox-profile=pointnetwork --keep-profile-changes --source-dir dist/prod --url https://point/"

# point-browser-dev starts a point browser instance loading the pointsdk extention from the dist folder so that it can also be worked on by the developer using extention hot reloading provided by web-ext. See the pointsdk repo for details.
alias point-browser-dev="web-ext run --firefox-profile=website_owner_docker --keep-profile-changes --source-dir dist --url https://point/"

# dexec is a helper function to start a bash terminal in a running docker container
dexec() { docker exec -it "$1" bash; }

# dclean is a helper function to remove unused docker images and prune docker system resources
dclean() { docker stop $(docker ps -a -q); docker rm -f $(docker ps -a -q); docker rmi -f $(docker images | grep "<none>" | awk "{print \$3}"); docker system prune -f; docker system prune --volumes -f; }